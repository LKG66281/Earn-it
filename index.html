<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earning App</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
</head>
<body>
    <h2>Login / Register</h2>

    <!-- ðŸ”¥ Mobile Number Input -->
    <input type="text" id="phone" placeholder="Enter Mobile Number">
    <div id="recaptcha-container"></div>
    
    <!-- ðŸš€ Login & Register Buttons -->
    <button onclick="register()">Register</button>
    <button onclick="login()">Login</button>

    <!-- ðŸš€ User Dashboard (Only visible after login) -->
    <div id="dashboard" style="display:none;">
        <h2>Welcome to Your Wallet</h2>
        <p>Your Balance: â‚¹<span id="balance">0</span></p>
        <button onclick="logout()">Logout</button>

        <!-- ðŸ”¥ AdCash Ads -->
        <script type="text/javascript">
            aclib.runAutoTag({
                zoneId: 'bwlkocoxc5',
            });
        </script>
    </div>

    <!-- ðŸ”¥ Firebase Configuration -->
    <script>
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_ID",
            appId: "YOUR_APP_ID",
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ðŸš€ Register Function
        function register() {
            let phoneNumber = document.getElementById("phone").value;
            let appVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container');

            firebase.auth().signInWithPhoneNumber(phoneNumber, appVerifier)
                .then((confirmationResult) => {
                    window.confirmationResult = confirmationResult;
                    let code = prompt("Enter OTP:");
                    return confirmationResult.confirm(code);
                })
                .then((result) => {
                    alert("Registration Successful!");
                    saveUserData(result.user);
                })
                .catch((error) => {
                    alert("Error: " + error.message);
                });
        }

        // ðŸš€ Save User Data to Firestore
        function saveUserData(user) {
            let userRef = db.collection("users").doc(user.uid);
            userRef.set({
                phone: user.phoneNumber,
                balance: 0
            }).then(() => {
                alert("User data saved!");
                showDashboard();
            });
        }

        // ðŸ”‘ Login Function
        function login() {
            let phoneNumber = document.getElementById("phone").value;
            let appVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container');

            firebase.auth().signInWithPhoneNumber(phoneNumber, appVerifier)
                .then((confirmationResult) => {
                    window.confirmationResult = confirmationResult;
                    let code = prompt("Enter OTP:");
                    return confirmationResult.confirm(code);
                })
                .then((result) => {
                    alert("Login Successful!");
                    showDashboard();
                })
                .catch((error) => {
                    alert("Error: " + error.message);
                });
        }

        // ðŸš€ Show Dashboard on Login
        function showDashboard() {
            document.getElementById("dashboard").style.display = "block";
        }

        // ðŸšª Logout Function
        function logout() {
            auth.signOut().then(() => {
                alert("Logged out!");
                document.getElementById("dashboard").style.display = "none";
            });
        }

        // ðŸš€ Display User Balance
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                let userRef = db.collection("users").doc(user.uid);
                userRef.get().then((doc) => {
                    if (doc.exists) {
                        document.getElementById("balance").innerText = doc.data().balance;
                        showDashboard();
                    }
                });
            }
        });
    </script>
</body>
</html>
